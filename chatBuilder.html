<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Backel's Chatbuilder</title>
    <script src="http://chatbuilder.hackreactor.com/ChatBuilder.js"></script>
  </head>
  
  <body>

    <script>
      
      Chat.guide.start();
      
      delete Chat.display;
      delete Chat.fetch;     

          // var displayer rebuilds Chat.display 
          var displayer = function (str) {
            if(typeof str === 'string') {
            var li = $('<li>');
            li.html(str);
            $(li).appendTo('ul'); // adds list items to messages class unordered list
            }
          };
          
          //this section replaces chat.fetch
          //something is wrong with this!!! fix it!!!
          var fetcher = function(callBack) {
            $.ajax({
              url: "https://api.parse.com/1/classes/chats?order=-createdAt", 
              //parse server url needed for chat.send also!! includes order property, remove later!?
              type: "GET"
              success: function(result){
                //*****requires a callback function*****
              };
              error: function (err){
                alert("Sorry, the server is not responding!", error);
              }
            });
          };
          

            //this section sends what is in the input box to the server (chat.send) 
          $( document ).ready(function(){ //loads this function after the rest of the html is loaded
            $(".send").on("click", function(e){
              event.preventDefault();
              var boxInput = $('.draft').val();
              Chat.send(boxInput);
              $('.draft').val(''); //clears input box after send is clicked
            }); 
            //this section ties chat.fetch, chat.display, and repeats the program every 3 seconds
            setInterval(function(){
              fetcher(function(arr){
                for(var i = 0; i < arr.length; i++){
                  displayer(arr[i])
                }    
              })
            }, 3000);
          });  

           
      
       
      
    </script>

    <h2>Broken Chat</h2>

    <input class="draft" type="text"/><button class="send">Send</button>
      
    <ul class="messages">
     <LH>Messages From RoboGod</LH>
      <!-- li messages go in here as they are pushed from chat.display-->
      
    </ul>

  </body>
</html>

